<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="expertManagement">

	<select id="selectExpertList"
	resultType="expertManagement">
		SELECT
			e.receive_no as receiveNo,
			e.member_no as memberNo,
			e.expert_file as expertFile,
			e.permission_state as permissionState, 
		    e.expert_grade as expertGrade,
		    c.third_category_nm as thirdCategoryNm
		FROM TBL_EXPERT_MANAGEMENT e
		JOIN TBL_CODE c ON e.third_category_cd = c.third_category_cd
	</select>

	<select id="getExpertDetail"
	parameterType="string"
	resultType="expertManagement">
	    SELECT 
	        e.receive_no AS receiveNo,
	        e.member_no AS memberNo,
	        COALESCE(ex.member_nickname, kak.member_nickname, nav.member_nickname) AS memberNickname,
	        COALESCE(ex.member_Addr, kak.member_Addr, nav.member_Addr) AS memberAddr,
	        e.expert_file AS expertFile,
	        e.permission_state AS permissionState,
	        e.expert_grade AS expertGrade,
	        c.third_category_nm AS thirdCategoryNm
	    FROM 
	        TBL_EXPERT_MANAGEMENT e
	    LEFT JOIN 
	        TBL_EXCO ex
	    ON 
	        e.member_no = ex.member_no
	    LEFT JOIN 
	        TBL_KAKAO_EXCO kak
	    ON 
	        e.member_no = kak.member_no
	    LEFT JOIN 
	        TBL_NAVER_EXCO nav
	    ON 
	        e.member_no = nav.member_no
	    JOIN 
	        TBL_CODE c
	    ON 
	        e.third_category_cd = c.third_category_cd
	    WHERE 
	        e.receive_no = #{receiveNo}
	</select>
	
	<!-- 소분류 코드로 전문가 정보 리스트 검색 -->
	<select id="viewExpertListByThirdCd"
	parameterType="string"
	resultType="expertIntro">
	SELECT
	    E.MEMBER_NO AS memberNo,
	    E.MEMBER_ID AS expertId,
	    E.MEMBER_PW AS expertPw,
	    E.MEMBER_NICKNAME AS expertNickname,
	    E.MEMBER_PHONE AS expertPhone,
	    E.MEMBER_ADDR AS expertAddr,
	    E.MEMBER_GENDER AS expertGender,
	    E.MEMBER_EMAIL AS expertEmail,
	    W.MEMBER_TYPE AS memberType,
	    E.ENROLL_DATE AS enrollDate,
	    M.THIRD_CATEGORY_CD AS thirdCategoryCd,
	    M.EXPERT_GRADE AS expertGrade,
	    M.EXPERT_FILE_NAME AS expertFileName,
	    M.EXPERT_FILE_PATH AS expertFilePath,
	    I.INTRODUCE_TITLE AS introduceTitle,
	    I.INTRODUCE_CONTENT AS introduceContent,
	    I.EXPERT_LIKE AS expertLike,
    	I.EXPERT_DISLIKE AS expertDislike,
    	P.PROFILE_PATH AS profilePath,
        P.PROFILE_NAME AS profileName
    FROM TBL_EXCO E
   	LEFT JOIN TBL_EXPERT_MANAGEMENT M
	ON E.MEMBER_NO = M.MEMBER_NO
	LEFT JOIN TBL_WHOLE_MEMBER W
	ON E.MEMBER_NO = W.MEMBER_NO
	LEFT JOIN TBL_EXPERT_INTRODUCE I
	ON I.MEMBER_NO = E.MEMBER_NO
	LEFT JOIN TBL_PROFILE_IMAGE P
    ON E.MEMBER_NO = P.MEMBER_NO
	WHERE M.THIRD_CATEGORY_CD = #{thirdCode}
	</select>
	
	<select id="viewExpertInfoByMemberNo"
	parameterType="string"
	resultType="expertIntro">
	SELECT
	    E.MEMBER_NO AS memberNo,
	    E.MEMBER_ID AS expertId,
	    E.MEMBER_PW AS expertPw,
	    E.MEMBER_NICKNAME AS expertNickname,
	    E.MEMBER_PHONE AS expertPhone,
	    E.MEMBER_ADDR AS expertAddr,
	    E.MEMBER_GENDER AS expertGender,
	    E.MEMBER_EMAIL AS expertEmail,
	    W.MEMBER_TYPE AS memberType,
	    E.ENROLL_DATE AS enrollDate,
	    M.THIRD_CATEGORY_CD AS thirdCategoryCd,
	    M.EXPERT_GRADE AS expertGrade,
	    M.EXPERT_FILE_NAME AS expertFileName,
	    M.EXPERT_FILE_PATH AS expertFilePath,
	    I.INTRODUCE_TITLE AS introduceTitle,
	    I.INTRODUCE_CONTENT AS introduceContent,
	    I.EXPERT_LIKE AS expertLike,
	    I.EXPERT_DISLIKE AS expertDislike,
	    C.THIRD_CATEGORY_NM AS thirdCategoryNm,
	    P.PROFILE_PATH AS profilePath,
        P.PROFILE_NAME AS profileName
	FROM TBL_EXCO E
	LEFT JOIN TBL_EXPERT_MANAGEMENT M
	    ON E.MEMBER_NO = M.MEMBER_NO
	LEFT JOIN TBL_WHOLE_MEMBER W
	    ON E.MEMBER_NO = W.MEMBER_NO
	LEFT JOIN TBL_EXPERT_INTRODUCE I
	    ON I.MEMBER_NO = E.MEMBER_NO
	LEFT JOIN TBL_CODE C
	    ON M.THIRD_CATEGORY_CD = C.THIRD_CATEGORY_CD
	LEFT JOIN TBL_PROFILE_IMAGE P
        ON E.MEMBER_NO = P.MEMBER_NO
	WHERE TRIM(E.MEMBER_NO) = #{thirdCode}
	</select>
	
	<select id="viewAllExpertList"
	resultType="expertIntro">
	SELECT
	    E.MEMBER_NO AS memberNo,
	    E.MEMBER_ID AS expertId,
	    E.MEMBER_PW AS expertPw,
	    E.MEMBER_NICKNAME AS expertNickname,
	    E.MEMBER_PHONE AS expertPhone,
	    E.MEMBER_ADDR AS expertAddr,
	    E.MEMBER_GENDER AS expertGender,
	    E.MEMBER_EMAIL AS expertEmail,
	    W.MEMBER_TYPE AS memberType,
	    E.ENROLL_DATE AS enrollDate,
	    M.THIRD_CATEGORY_CD AS thirdCategoryCd,
	    M.EXPERT_GRADE AS expertGrade,
	    M.EXPERT_FILE_NAME AS expertFileName,
	    M.EXPERT_FILE_PATH AS expertFilePath,
	    I.INTRODUCE_TITLE AS introduceTitle,
	    I.INTRODUCE_CONTENT AS introduceContent,
	    I.EXPERT_LIKE AS expertLike,
    	I.EXPERT_DISLIKE AS expertDislike,
    	P.PROFILE_PATH AS profilePath,
        P.PROFILE_NAME AS profileName
	FROM TBL_EXCO E
	LEFT JOIN TBL_EXPERT_MANAGEMENT M
	ON E.MEMBER_NO = M.MEMBER_NO
	LEFT JOIN TBL_WHOLE_MEMBER W
	ON E.MEMBER_NO = W.MEMBER_NO
	LEFT JOIN TBL_EXPERT_INTRODUCE I
	ON I.MEMBER_NO = E.MEMBER_NO
	LEFT JOIN TBL_PROFILE_IMAGE P
    ON E.MEMBER_NO = P.MEMBER_NO
	</select>
	
	<select id="srchExpertsByKeyList"
	parameterType="list"
	resultType="expertIntro">
	SELECT
		E.MEMBER_NO AS memberNo,
	    E.MEMBER_ID AS expertId,
	    E.MEMBER_PW AS expertPw,
	    E.MEMBER_NICKNAME AS expertNickname,
	    E.MEMBER_PHONE AS expertPhone,
	    E.MEMBER_ADDR AS expertAddr,
	    E.MEMBER_GENDER AS expertGender,
	    E.MEMBER_EMAIL AS expertEmail,
	    W.MEMBER_TYPE AS memberType,
	    E.ENROLL_DATE AS enrollDate,
	    M.THIRD_CATEGORY_CD AS thirdCategoryCd,
	    M.EXPERT_GRADE AS expertGrade,
	    M.EXPERT_FILE_NAME AS expertFileName,
	    M.EXPERT_FILE_PATH AS expertFilePath,
	    I.INTRODUCE_TITLE AS introduceTitle,
	    I.INTRODUCE_CONTENT AS introduceContent,
	    I.EXPERT_LIKE AS expertLike,
    	I.EXPERT_DISLIKE AS expertDislike,
    	P.PROFILE_PATH AS profilePath,
        P.PROFILE_NAME AS profileName
        FROM TBL_EXCO E
	LEFT JOIN TBL_EXPERT_MANAGEMENT M
	ON E.MEMBER_NO = M.MEMBER_NO
	LEFT JOIN TBL_WHOLE_MEMBER W
	ON E.MEMBER_NO = W.MEMBER_NO
	LEFT JOIN TBL_EXPERT_INTRODUCE I
	ON I.MEMBER_NO = E.MEMBER_NO
	LEFT JOIN TBL_PROFILE_IMAGE P
    ON E.MEMBER_NO = P.MEMBER_NO
        WHERE THIRD_CATEGORY_CD IN
        <foreach collection="list" item="keywords" open="(" separator="," close=")">
            #{keywords}
        </foreach>
	</select>
	

	<select id="findExpertsByCategory" parameterType="string" resultType="expertIntro">
        SELECT 
		    em.receive_no AS receiveNo, 
		    em.member_no AS memberNo, 
		    COALESCE(e.member_nickname, k.member_nickname, n.member_nickname) AS expertNickName, 
		    em.expert_file_name AS expertFile, 
		    em.expert_file_path AS expertFilePath,
		    em.permission_state AS permissionState, 
		    em.expert_grade AS expertGrade,
		    c.third_category_nm AS thirdCategoryNm
		FROM 
		    TBL_EXPERT_MANAGEMENT em
		JOIN 
		    TBL_WHOLE_MEMBER wm ON em.member_no = wm.member_no
		LEFT JOIN 
		    TBL_EXCO e ON wm.member_no = e.member_no
		LEFT JOIN 
		    TBL_KAKAO_EXCO k ON wm.member_no = k.member_no
		LEFT JOIN 
		    TBL_NAVER_EXCO n ON wm.member_no = n.member_no
		JOIN 
		    TBL_CODE c ON em.third_category_cd = c.third_category_cd
		WHERE 
		    c.third_category_nm = #{categoryNm}
    </select>

	<select id="viewBestExpertList"
	resultType="expertIntro">
	SELECT
	    MEMBER_NO AS memberNo,
	    MEMBER_ID AS expertId,
	    MEMBER_PW AS expertPw,
	    MEMBER_NICKNAME AS expertNickname,
	    MEMBER_PHONE AS expertPhone,
	    MEMBER_ADDR AS expertAddr,
	    MEMBER_GENDER AS expertGender,
	    MEMBER_EMAIL AS expertEmail,
	    MEMBER_TYPE AS memberType,
	    ENROLL_DATE AS enrollDate,
	    THIRD_CATEGORY_CD AS thirdCategoryCd,
	    EXPERT_GRADE AS expertGrade,
	    EXPERT_FILE_NAME AS expertFileName,
	    EXPERT_FILE_PATH AS expertFilePath,
	    INTRODUCE_TITLE AS introduceTitle,
	    INTRODUCE_CONTENT AS introduceContent,
	    EXPERT_LIKE AS expertLike,
	    EXPERT_DISLIKE AS expertDislike,
	    PROFILE_PATH AS profilePath,
	    PROFILE_NAME AS profileName
	FROM
	    (SELECT
	        E.MEMBER_NO,
	        E.MEMBER_ID,
	        E.MEMBER_PW,
	        E.MEMBER_NICKNAME,
	        E.MEMBER_PHONE,
	        E.MEMBER_ADDR,
	        E.MEMBER_GENDER,
	        E.MEMBER_EMAIL,
	        W.MEMBER_TYPE,
	        E.ENROLL_DATE,
	        M.THIRD_CATEGORY_CD,
	        M.EXPERT_GRADE,
	        M.EXPERT_FILE_NAME,
	        M.EXPERT_FILE_PATH,
	        I.INTRODUCE_TITLE AS,
	        I.INTRODUCE_CONTENT,
	        I.EXPERT_LIKE,
	        I.EXPERT_DISLIKE,
	        P.PROFILE_PATH,
	        P.PROFILE_NAME
		FROM TBL_EXCO E
		LEFT JOIN TBL_EXPERT_MANAGEMENT M
		ON E.MEMBER_NO = M.MEMBER_NO
		LEFT JOIN TBL_WHOLE_MEMBER W
		ON E.MEMBER_NO = W.MEMBER_NO
		LEFT JOIN TBL_EXPERT_INTRODUCE I
		ON I.MEMBER_NO = E.MEMBER_NO
		LEFT JOIN TBL_PROFILE_IMAGE P
	    ON E.MEMBER_NO = P.MEMBER_NO
	    ORDER BY I.EXPERT_LIKE DESC NULLS LAST)
	    WHERE ROWNUM &lt; 6
	</select>
</mapper>

